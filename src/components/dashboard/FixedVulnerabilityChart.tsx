
import React, { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';

// Sample data
const vulnerabilityData = {
  severity: [
    { name: 'Critical', value: 7, color: '#ef4444' },
    { name: 'High', value: 15, color: '#f97316' },
    { name: 'Medium', value: 28, color: '#eab308' },
    { name: 'Low', value: 54, color: '#22c55e' },
  ],
  category: [
    { name: 'Outdated Software', value: 32, color: '#3b82f6' },
    { name: 'Misconfigurations', value: 24, color: '#a855f7' },
    { name: 'Authentication', value: 18, color: '#ec4899' },
    { name: 'Network', value: 12, color: '#14b8a6' },
    { name: 'Other', value: 18, color: '#64748b' },
  ],
  timeline: [
    { name: 'Jan', value: 45 },
    { name: 'Feb', value: 52 },
    { name: 'Mar', value: 49 },
    { name: 'Apr', value: 63 },
    { name: 'May', value: 59 },
    { name: 'Jun', value: 47 },
    { name: 'Jul', value: 71 },
    { name: 'Aug', value: 82 },
    { name: 'Sep', value: 104 },
  ]
};

const CHART_HEIGHT = 300;

// Custom tooltip component
const CustomTooltip = ({ active, payload, label }: any) => {
  if (active && payload && payload.length) {
    return (
      <div className="bg-white p-2 border rounded-md shadow-sm text-xs">
        <p className="font-medium">{`${label}: ${payload[0].value}`}</p>
      </div>
    );
  }
  return null;
};

const FixedVulnerabilityChart = () => {
  const [activeTab, setActiveTab] = useState('severity');

  return (
    <Card className="h-full">
      <CardHeader className="pb-3">
        <CardTitle className="text-base font-medium">Vulnerability Analysis</CardTitle>
      </CardHeader>
      <CardContent className="p-0">
        <Tabs defaultValue="severity" className="w-full" onValueChange={setActiveTab}>
          <TabsList className="w-full rounded-none border-b grid grid-cols-3 h-9">
            <TabsTrigger value="severity" className="text-xs rounded-none">By Severity</TabsTrigger>
            <TabsTrigger value="category" className="text-xs rounded-none">By Category</TabsTrigger>
            <TabsTrigger value="timeline" className="text-xs rounded-none">Timeline</TabsTrigger>
          </TabsList>
          
          <div className="p-4">
            <TabsContent value="severity" className="mt-0">
              <div className="h-[300px] w-full">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart
                    data={vulnerabilityData.severity}
                    margin={{ top: 20, right: 30, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                    <XAxis dataKey="name" tick={{ fontSize: 12 }} />
                    <YAxis tick={{ fontSize: 12 }} />
                    <Tooltip content={<CustomTooltip />} />
                    <Bar dataKey="value" radius={[4, 4, 0, 0]}>
                      {vulnerabilityData.severity.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.color} />
                      ))}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </TabsContent>
            
            <TabsContent value="category" className="mt-0">
              <div className="h-[300px] w-full">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart
                    data={vulnerabilityData.category}
                    margin={{ top: 20, right: 30, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                    <XAxis dataKey="name" tick={{ fontSize: 12 }} />
                    <YAxis tick={{ fontSize: 12 }} />
                    <Tooltip content={<CustomTooltip />} />
                    <Bar dataKey="value" radius={[4, 4, 0, 0]}>
                      {vulnerabilityData.category.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.color} />
                      ))}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </TabsContent>
            
            <TabsContent value="timeline" className="mt-0">
              <div className="h-[300px] w-full">
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart
                    data={vulnerabilityData.timeline}
                    margin={{ top: 20, right: 30, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                    <XAxis dataKey="name" tick={{ fontSize: 12 }} />
                    <YAxis tick={{ fontSize: 12 }} />
                    <Tooltip content={<CustomTooltip />} />
                    <Bar dataKey="value" fill="#3b82f6" radius={[4, 4, 0, 0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            </TabsContent>
          </div>
        </Tabs>
      </CardContent>
    </Card>
  );
};

export default FixedVulnerabilityChart;
